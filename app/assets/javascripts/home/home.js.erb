/*global angular*/
/*global $*/

angular.module('ErikGibbons.Home', [
  'ui.router',
  'templates',
  'ngMaterial',
  'ngMdIcons',
  'ui.bootstrap',
  'ngSanitize',
  'ngParallax',
  'ngPhotoswipe'
])

.config(['$stateProvider', function($stateProvider){
  $stateProvider
    .state('erikgibbons.home', {
      url: '/',
      views: {
        'main@': { // target the 'main' ng-view directive
          controller:  'HomeCtrl as homeCtrl',
          templateUrl: 'home/home.tmpl.html'
        }
      }
    })
  }
])
  
.controller('HomeCtrl', ['$q', '$http', '$window', '$log', '$location', '$state', '$filter', '$timeout', function($q, $http, $window, $log, $location, $state, $filter, $timeout, $document){
  var homeCtrl = this;
  homeCtrl.setArrays = setArrays;
  homeCtrl.selectAll = selectAll;
  homeCtrl.showGallery = showGallery;
  homeCtrl.closeGallery = closeGallery;
  homeCtrl.allSkillsSelected = true;  
  homeCtrl.opts = {
    history: false,
    index: 0
  };
  homeCtrl.projects = [
    {'name':'IPR Dominator', 'skills':['html', 'css', 'api', 'async', 'ror', 'js', 'jq', 'sql', 'io', 'alerts', 'stack', 'solr', 'charts', 'regex'], 'images':[{'src':'assets/placeholder.png', 'w':300, 'h':300}], 'url':'x'},
    {'name':'Strain PLLC Time and Billing', 'skills':['html', 'css', 'async', 'ror', 'js', 'jq', 'sql', 'charts', 'io', 'stack', 'regex'], 'images':[{'src':'assets/placeholder.png', 'w':300, 'h':300}], 'url':'x'},
    {'name':'iMessage Port', 'skills':['html', 'css', 'ror', 'sql', 'cron', 'io', 'alerts', 'stack', 'regex'], 'images':[{'src':'assets/placeholder.png', 'w':300, 'h':300}], 'url':'x'},
    {'name':'Personal Movie Database', 'skills':['html', 'css', 'ror', 'api', 'js', 'jq', 'sql', 'angular', 'io', 'stack', 'regex'], 'images':[{'src':'assets/placeholder.png', 'w':300, 'h':300}], 'url':'x'},
    {'name':'Stock Screener', 'skills':['html', 'css', 'stack', 'sql', 'async', 'ror', 'js', 'jq', 'io', 'regex'], 'images':[{'src':'assets/placeholder.png', 'w':300, 'h':300}], 'url':'x'},
    {'name':'RosterMod', 'skills':['html', 'css', 'stack', 'sql', 'ror', 'api', 'async', 'js', 'jq', 'angular', 'charts', 'regex'], 'images':[{'src':'assets/placeholder.png', 'w':300, 'h':300}], 'url':'x'},
    {'name':'Team Schedule API', 'skills':['html', 'css', 'stack', 'sql', 'ror', 'api', 'regex'], 'images':[{'src':'assets/placeholder.png', 'w':300, 'h':300}], 'url':'x'},
    {'name':'Grill Monitoring', 'skills':['html', 'css', 'stack', 'sql', 'ror', 'api', 'regex', 'js', 'jq', 'charts'], 'images':[{'src':'assets/placeholder.png', 'w':300, 'h':300}], 'url':'x'},
    {'name':'Flight Check-In', 'skills':['html', 'css', 'stack', 'sql', 'ror', 'api', 'async', 'regex'], 'images':[{'src':'assets/placeholder.png', 'w':300, 'h':300}], 'url':'x'},
    {'name':'Patent Search', 'skills':['html', 'css', 'stack', 'sql', 'ror', 'api', 'solr'], 'images':[{'src':'assets/placeholder.png', 'w':300, 'h':300}], 'url':'x'},
    {'name':'Oystermom', 'skills':['html', 'css', 'stack', 'sql', 'ror', 'js', 'jq'], 'images':[{'src':'assets/placeholder.png', 'w':300, 'h':300}], 'url':'x'}
  ];
  homeCtrl.skills = [
    {'full':'HTML', 'short':'html','show':true},
    {'full':'CSS', 'short':'css','show':true},
    {'full':'Web Scraping and APIs', 'short':'api','show':true},
    {'full':'Multithreaded Asynchronous Jobs', 'short':'async','show':true},
    {'full':'Ruby on Rails', 'short':'ror','show':true},
    {'full':'Javascript', 'short':'js','show':true},
    {'full':'jQuery', 'short':'jq','show':true},
    {'full':'SQL', 'short':'sql','show':true},
    {'full':'CRON Jobs', 'short':'cron','show':true},
    {'full':'Angular', 'short':'angular','show':true},
    {'full':'Charts', 'short':'charts','show':true},
    {'full':'Import/Export Files', 'short':'io','show':true},
    {'full':'Alerts/Emails', 'short':'alerts','show':true},
    {'full':'Full Stack', 'short':'stack','show':true},
    {'full':'Websolr', 'short':'solr','show':true},
    {'full':'Regular Expressions', 'short':'regex','show':true}
  ];

  function init() {
    homeCtrl.setArrays();
  } // end of init
  
  init();
  
  /*********************
  *  Private functions *
  * *******************/
  
  // Function to reset variables whenever checkbox is clicked
  function setArrays(){
    homeCtrl.activeSkillsArray = $filter('filter')(homeCtrl.skills, function(v){
      if(v['show']){
        return v
      }
    }).map(function(e){
      return e['short'];
    });
    
    // projects that include checked skills
    homeCtrl.showProj = $filter('filter')(homeCtrl.projects, function(v){
      return v['skills'].some(s => homeCtrl.activeSkillsArray.includes(s));
    });
    
    // if all skills are checked or unchecked, reflect that in allSkillsSelected
    if(homeCtrl.activeSkillsArray.length == homeCtrl.skills.length){
      homeCtrl.allSkillsSelected = true;
    }else{
      homeCtrl.allSkillsSelected = false
    }
  }
  
  function selectAll(){
    console.log('sele')
    if(homeCtrl.allSkillsSelected == true){
      angular.forEach(homeCtrl.skills, function(v){
        v['show'] = false;
      });
    }else{
      angular.forEach(homeCtrl.skills, function(v){
        v['show'] = true;
      });
    }
    homeCtrl.setArrays();
  }
  
  function showGallery(){
    homeCtrl.open = true;
  }
  
  function closeGallery(){
    homeCtrl.open = false;
  }
}]);